name: Deploy to Cloudflare Pages
description: Deploys the Next.js project on Cloudflare Pages.

inputs:
  cloudflare-api-token:
    description: 'Cloudflare API token with Zone:Read and Zone:Edit permissions'
    required: true
  cloudflare-account-id:
    description: 'Cloudflare account ID'
    required: true
  project-name:
    description: 'Cloudflare Pages project name'
    required: true
  directory:
    description: 'Directory containing the built files'
    required: false
    default: '.next/static'
  working-directory:
    description: 'Working directory to run commands from'
    required: false
    default: '.'

runs:
  using: 'composite'
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 'lts/*'

    - name: Setup pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 10

    - name: Install dependencies
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: pnpm install --frozen-lockfile

    - name: Build project
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: pnpm build

    - name: Deploy to Cloudflare Pages
      uses: cloudflare/wrangler-action@v3
      with:
        apiToken: ${{ inputs.cloudflare-api-token }}
        accountId: ${{ inputs.cloudflare-account-id }}
        command: pages deploy ${{ inputs.working-directory }}/${{ inputs.directory }} --project-name=${{ inputs.project-name }}
        gitHubToken: ${{ github.token }}
  